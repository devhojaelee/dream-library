# Z-Library Korean Book Downloader - Task Plan

## 목표
Z-Library의 "Personally Recommended" 섹션에서 한국어 책을 자동으로 다운로드하는 스크립트 작성

## 제약 사항
- 하루 다운로드 한도: 999개
- 저작권이 만료된 책만 대상
- 계정 로그인 필수

## 필터링 조건
- ✅ 한국어 책만 다운로드
- ❌ 주식/금융 관련 책 제외
- ❌ 철학/예술 관련 책 제외
- ❌ 이미 다운로드한 책 제외

## 작업 체크리스트

### Phase 1: 환경 설정
- [x] Python venv 생성
- [x] Playwright 설치
- [x] Chromium 브라우저 설치
- [x] 사이트 구조 초기 분석

### Phase 2: 로그인 기능 구현
- [ ] 로그인 페이지 이동
- [ ] 로그인 폼 요소 식별
- [ ] 자격증명 입력 및 로그인 처리
- [ ] 로그인 성공 검증
- [ ] 세션 유지 확인

### Phase 3: Personally Recommended 페이지 탐색
- [ ] "Personally Recommended" 섹션 찾기
- [ ] 해당 페이지로 이동
- [ ] 페이지 로딩 대기 처리

### Phase 4: 책 목록 수집
- [ ] 초기 책 목록 파싱
- [ ] "Load more" 버튼 찾기 및 클릭 반복
- [ ] 각 책의 메타데이터 수집:
  - [ ] 제목
  - [ ] 언어
  - [ ] 카테고리/장르
  - [ ] 다운로드 상태 (이미 다운로드 여부)
  - [ ] 다운로드 URL/버튼
- [ ] 한국어 필터링 적용
- [ ] 제외 카테고리 필터링 (주식/금융, 철학/예술)
- [ ] 이미 다운로드한 책 제외

### Phase 5: 다운로드 실행
- [ ] 다운로드 버튼 클릭 메커니즘 구현
- [ ] 다운로드 진행 상황 추적
- [ ] 999개 한도 카운터 구현
- [ ] 다운로드 완료 확인
- [ ] 파일명 및 저장 위치 관리

### Phase 6: 에러 처리 및 로깅
- [ ] 네트워크 오류 처리
- [ ] 다운로드 실패 시 재시도 로직
- [ ] 진행 상황 로그 파일 생성
- [ ] 실패한 다운로드 목록 기록
- [ ] 중단 시 재개 기능 (체크포인트)

### Phase 7: 테스트 및 최적화
- [ ] 소량 테스트 (5-10개 책)
- [ ] 속도 및 안정성 검증
- [ ] 다운로드 한도 도달 시 정상 종료 확인
- [ ] 최종 실행 및 모니터링

## 기술 스택
- Python 3.x
- Playwright (브라우저 자동화)
- 파일 시스템 관리

## 예상 문제점 및 해결책
1. **동적 콘텐츠 로딩**: Playwright의 대기 메커니즘 활용
2. **다운로드 한도 추적**: 카운터 변수 및 로그 파일
3. **세션 타임아웃**: 주기적인 활동 유지
4. **네트워크 불안정**: 재시도 로직 및 타임아웃 설정
5. **카테고리 필터링 정확도**: 키워드 기반 매칭 및 수동 검증 필요 시

## 구현 완료 ✅

### 최종 스크립트
- **파일명**: `final_downloader.py`
- **실행 방법**: `source venv/bin/activate && python final_downloader.py`

### 주요 기능
1. ✅ 자동 로그인
2. ✅ Personally Recommended 섹션 탐색
3. ✅ 한국어 책 필터링 (한글 문자 감지)
4. ✅ 제외 카테고리 필터링 (주식/금융, 철학, 예술)
5. ✅ Load more 자동 클릭 (최대 3회)
6. ✅ 자동 다운로드 (최대 999개)
7. ✅ 진행 상황 로깅 (JSON 파일)
8. ✅ 다운로드 폴더: `./books/`

### 사용 방법
```bash
# 가상환경 활성화
source venv/bin/activate

# 스크립트 실행
python final_downloader.py
```

### 출력 파일
- 다운로드한 책: `./books/` 디렉토리
- 진행 로그: `download_log_YYYYMMDD_HHMMSS.json`

### 로그 파일 포맷
```json
{
  "downloaded_count": 숫자,
  "downloaded_books": [다운로드 성공한 책 목록],
  "failed_books": [다운로드 실패한 책 목록],
  "skipped_books": [제외된 책 목록],
  "timestamp": "ISO 시간"
}
```
